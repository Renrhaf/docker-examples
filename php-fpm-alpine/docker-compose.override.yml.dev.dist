# Docker compose file for the cloud dev server.
version: "2"
services:
    app:
        networks:
            - reverse-proxy
            - global
            - opt
        volumes:
            - ".:/app"
            - "~/.composer:/root/.composer"

    # Nginx container.
    nginx:
        image: nginx
        container_name: opt_nginx
        expose:
          - "80"
          - "443"
        volumes:
          - "./docker/nginx.conf:/etc/nginx/nginx.conf"
          - "./docker/.htpasswd:/etc/nginx/.htpasswd"
          - "./docker/certificates/ssl-cert-snakeoil.pem:/etc/ssl/certs/ssl-cert-snakeoil.pem"
          - "./docker/certificates/ssl-cert-snakeoil.key:/etc/ssl/private/ssl-cert-snakeoil.key"
        environment:
          - VIRTUAL_HOST=opt.dev.skazy.name,corporate.opt.dev.skazy.name
          - LETSENCRYPT_HOST=opt.dev.skazy.name
          - LETSENCRYPT_EMAIL=cloud@skazy.nc

networks:
  # Reverse proxy network.
  # You may need to throw the command : "docker network create reverse-proxy"
  reverse-proxy:
    external:
      name: reverse-proxy

  # Global shared network.
  # You may need to throw the command : "docker network create global"
  global:
      external:
        name: global

  # Project specific network
  opt:
    driver: bridge
